"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"function"==typeof define&&define.amd?define(["tether"],e):"object"==("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e(require("tether")):t.Shepherd=e(t.Tether)}(void 0,function(i){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+_typeof(e));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function p(t){return void 0===t}function s(t){return"object"==_typeof(t)}function c(t){var e=document.createElement("div");return e.innerHTML=t,e.children[0]}var e=function(t,e,n){return e&&k(t.prototype,e),n&&k(t,n),t},r=function(t,e,n){for(var i=!0;i;){var o=t,r=e,s=n,i=!1;null===o&&(o=Function.prototype);var h=Object.getOwnPropertyDescriptor(o,r);if(void 0!==h){if("value"in h)return h.value;var c=h.get;if(void 0===c)return;return c.call(s)}var l=Object.getPrototypeOf(o);if(null===l)return;t=l,e=r,n=s,i=!0,h=l=void 0}},n=i.Utils,h=n.Evented,l=n.addClass,a=n.extend,u=n.hasClass,d=n.removeClass,f=n.uniqueId,v=new h,y={"top right":"bottom left","top left":"bottom right","top center":"bottom center","middle right":"middle left","middle left":"middle right","middle center":"middle center","bottom left":"top right","bottom right":"top left","bottom center":"top center",top:"bottom center",left:"middle right",right:"middle left",bottom:"top center",center:"middle center",middle:"middle center"},m=/^(.+) (top|left|right|bottom|center|\[[a-z ]+\])$/,b=(t(S,h),e(S,[{key:"bindMethods",value:function(){var e=this;["_show","show","hide","isOpen","cancel","complete","scrollTo","destroy","render"].map(function(t){e[t]=e[t].bind(e)})}},{key:"setOptions",value:function(t){var e=arguments.length<=0||void 0===t?{}:t;this.options=e,this.destroy(),this.id=this.options.id||this.id||"step-"+f();var n,i=this.options.when;if(i)for(var o in i)!{}.hasOwnProperty.call(i,o)||(n=i[o],this.on(o,n,this));var r,s,h=JSON.stringify(this.options.buttons),c=p(h)||"true"===h,l="{}"===h||"[]"===h||"null"===h||"false"===h,a=!c&&(s=this.options.buttons)&&s.constructor===Array,u=!c&&(r=this.options.buttons)&&r.constructor===Object;c?this.options.buttons=[{text:"Next",action:this.tour.next,classes:"btn"}]:!l&&u?this.options.buttons=[this.options.buttons]:!l&&a||(this.options.buttons=!1)}},{key:"getTour",value:function(){return this.tour}},{key:"bindAdvance",value:function(){function t(t){var e,n,i;o.isOpen()&&(p(r)?o.el&&t.target===o.el&&o.tour.next():(e=t.target,n=r,i=void 0,p(e.matches)?p(e.matchesSelector)?p(e.msMatchesSelector)?p(e.webkitMatchesSelector)?p(e.mozMatchesSelector)?p(e.oMatchesSelector)||(i=e.oMatchesSelector):i=e.mozMatchesSelector:i=e.webkitMatchesSelector:i=e.msMatchesSelector:i=e.matchesSelector:i=e.matches,i.call(e,n)&&o.tour.next()))}var o=this,e=function(t,e){if(null===t||p(t))return t;if(s(t))return t;for(var n=t.split(" "),i={},o=e.length-1,r=n.length-1;0<=r;r--){if(0===o){i[e[o]]=n.slice(0,r+1).join(" ");break}i[e[o]]=n[r],o--}return i}(this.options.advanceOn,["selector","event"]),n=e.event,r=e.selector;document.body.addEventListener(n,t),this.on("destroy",function(){return document.body.removeEventListener(n,t)})}},{key:"getAttachTo",value:function(){var t=function(t){if(s(t))return t.hasOwnProperty("element")&&t.hasOwnProperty("on")?t:null;var e=m.exec(t);if(!e)return null;var n=e[2];return"["===n[0]&&(n=n.substring(1,n.length-1)),{element:e[1],on:n}}(this.options.attachTo)||{},e=a({},t);return"string"==typeof t.element&&(e.element=document.querySelector(t.element),e.element||console.error("The element for this Shepherd step was not found "+t.element)),e}},{key:"setupTether",value:function(){if(p(i))throw new Error("Using the attachment feature of Shepherd requires the Tether library");var t=this.getAttachTo(),e=y[t.on]||y.right;p(t.element)&&(t.element="viewport",e="middle center");var n={classPrefix:"shepherd",element:this.el,constraints:[{to:"window",pin:!0,attachment:"together"}],target:t.element,offset:t.offset||"0 0",attachment:e};this.tether&&this.tether.destroy(),this.tether=new i(a(n,this.options.tetherOptions))}},{key:"show",value:function(){var t=this;if(!p(this.options.beforeShowPromise)){var e=this.options.beforeShowPromise();if(!p(e))return e.then(function(){return t._show()})}this._show()}},{key:"_show",value:function(){var t=this;this.trigger("before-show"),this.el||this.render(),l(this.el,"shepherd-open"),document.body.setAttribute("data-shepherd-step",this.id),this.setupTether(),this.options.scrollTo&&setTimeout(function(){t.scrollTo()}),this.trigger("show")}},{key:"hide",value:function(){this.trigger("before-hide"),d(this.el,"shepherd-open"),document.body.removeAttribute("data-shepherd-step"),this.tether&&this.tether.destroy(),this.tether=null,this.trigger("hide")}},{key:"isOpen",value:function(){return this.el&&u(this.el,"shepherd-open")}},{key:"cancel",value:function(){this.tour.cancel(),this.trigger("cancel")}},{key:"complete",value:function(){this.tour.complete(),this.trigger("complete")}},{key:"scrollTo",value:function(){var t=this.getAttachTo().element;p(this.options.scrollToHandler)?p(t)||t.scrollIntoView():this.options.scrollToHandler(t)}},{key:"destroy",value:function(){!p(this.el)&&this.el.parentNode&&(this.el.parentNode.removeChild(this.el),delete this.el),this.tether&&this.tether.destroy(),this.tether=null,this.trigger("destroy")}},{key:"render",value:function(){var n=this;p(this.el)||this.destroy(),this.el=c("<div class='shepherd-step "+(this.options.classes||"")+"' data-id='"+this.id+"' "+(this.options.idAttribute?'id="'+this.options.idAttribute+'"':"")+"></div>");var t=document.createElement("div");t.className="shepherd-content",this.el.appendChild(t);var e,i,o,r,s,h=document.createElement("header");t.appendChild(h),this.options.title&&(h.innerHTML+="<h3 class='shepherd-title'>"+this.options.title+"</h3>",this.el.className+=" shepherd-has-title"),this.options.showCancelLink&&(e=c("<a href class='shepherd-cancel-link'>âœ•</a>"),h.appendChild(e),this.el.className+=" shepherd-has-cancel-link",this.bindCancelLink(e)),p(this.options.text)||(r=c("<div class='shepherd-text'></div>"),"function"==typeof(s=n.options.text)&&(s=s.call(n,r)),s instanceof HTMLElement?r.appendChild(s):("string"==typeof s&&(s=[s]),s.map(function(t){r.innerHTML+="<p>"+t+"</p>"})),t.appendChild(r)),this.options.buttons&&(i=document.createElement("footer"),o=c("<ul class='shepherd-buttons'></ul>"),n.options.buttons.map(function(t){var e=c("<li><a class='shepherd-button "+(t.classes||"")+"'>"+t.text+"</a>");o.appendChild(e),n.bindButtonEvents(t,e.querySelector("a"))}),i.appendChild(o),t.appendChild(i)),document.body.appendChild(this.el),this.setupTether(),this.options.advanceOn&&this.bindAdvance()}},{key:"bindCancelLink",value:function(t){var e=this;t.addEventListener("click",function(t){t.preventDefault(),e.cancel()})}},{key:"bindButtonEvents",value:function(n,i){var e,o=this;for(var t in n.events=n.events||{},p(n.action)||(n.events.click=n.action),n.events)!{}.hasOwnProperty.call(n.events,t)||("string"==typeof(e=n.events[t])&&function(){var t=e;e=function(){return o.tour.show(t)}}(),i.addEventListener(t,e));this.on("destroy",function(){for(var t in n.events){var e;!{}.hasOwnProperty.call(n.events,t)||(e=n.events[t],i.removeEventListener(t,e))}})}}]),S),g=(t(w,h),e(w,[{key:"bindMethods",value:function(){var e=this;["next","back","cancel","complete","hide"].map(function(t){e[t]=e[t].bind(e)})}},{key:"addStep",value:function(t,e){return p(e)&&(e=t),e instanceof b?e.tour=this:("string"!=typeof t&&"number"!=typeof t||(e.id=t.toString()),e=a({},this.options.defaults,e),e=new b(this,e)),this.steps.push(e),this}},{key:"removeStep",value:function(t){for(var e=this.getCurrentStep(),n=0;n<this.steps.length;++n){var i=this.steps[n];if(i.id===t){i.isOpen()&&i.hide(),i.destroy(),this.steps.splice(n,1);break}}e&&e.id===t&&(this.currentStep=void 0,this.steps.length?this.show(0):this.hide())}},{key:"getById",value:function(t){for(var e=0;e<this.steps.length;++e){var n=this.steps[e];if(n.id===t)return n}}},{key:"getCurrentStep",value:function(){return this.currentStep}},{key:"next",value:function(){var t=this.steps.indexOf(this.currentStep);t===this.steps.length-1?(this.hide(t),this.trigger("complete"),this.done()):this.show(t+1,!0)}},{key:"back",value:function(){var t=this.steps.indexOf(this.currentStep);this.show(t-1,!1)}},{key:"cancel",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("cancel"),this.done()}},{key:"complete",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("complete"),this.done()}},{key:"hide",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("hide"),this.done()}},{key:"done",value:function(){v.activeTour=null,d(document.body,"shepherd-active"),this.trigger("inactive",{tour:this})}},{key:"show",value:function(t,e){var n=arguments.length<=0||void 0===t?0:t,i=arguments.length<=1||void 0===e||e;this.currentStep?this.currentStep.hide():(l(document.body,"shepherd-active"),this.trigger("active",{tour:this})),v.activeTour=this;var o,r,s=void 0;(s="string"==typeof n?this.getById(n):this.steps[n])&&(p(s.options.showOn)||s.options.showOn()?(this.trigger("show",{step:s,previous:this.currentStep}),this.currentStep&&this.currentStep.hide(),(this.currentStep=s).show()):(o=this.steps.indexOf(s),r=i?o+1:o-1,this.show(r,i)))}},{key:"start",value:function(){this.trigger("start"),this.currentStep=null,this.next()}}]),w);function w(){var n=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o(this,w),r(Object.getPrototypeOf(w.prototype),"constructor",this).call(this,t),this.bindMethods(),this.options=t,this.steps=this.options.steps||[];return["complete","cancel","hide","start","show","active","inactive"].map(function(t){var e;e=t,n.on(e,function(t){(t=t||{}).tour=n,v.trigger(e,t)})}),this}function S(t,e){return o(this,S),r(Object.getPrototypeOf(S.prototype),"constructor",this).call(this,t,e),this.tour=t,this.bindMethods(),this.setOptions(e),this}function k(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return a(v,{Tour:g,Step:b,Evented:h}),v});