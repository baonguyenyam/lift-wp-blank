"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var updraft_restore_screen=!0;jQuery(function(p){var u,l,i,c=p("#updraftplus_ajax_restore_job_id").val(),e=p("#updraftplus_ajax_restore_action").val(),_=0,f=p("#updraftplus_ajax_restore_output"),g=p(".updraft_restore_components_list"),r=!1,h=0,m=0;function y(e,t){var r=new XMLHttpRequest,e="action="+t+"&updraftplus_ajax_restore=do_ajax_restore&job_id="+e,o=0,n=!0,d=p("#updraftplus_ajax_restore_debug").length;r.open("POST",ajaxurl,!0),r.onprogress=function(e){if(200<=e.currentTarget.status&&e.currentTarget.status<300){if(-1!==e.currentTarget.responseText.indexOf("<html"))return n&&(n=!1,alert("UpdraftPlus "+updraftlion.ajax_restore_error+" "+updraftlion.ajax_restore_invalid_response)),f.append("UpdraftPlus "+updraftlion.ajax_restore_error+" "+updraftlion.ajax_restore_invalid_response),console.log("UpdraftPlus restore error: HTML detected in response could be a copy of the WordPress front page caused by mod_security"),void console.log(e.currentTarget.responseText);if(o!=e.currentTarget.responseText.length){_=Math.round(Date.now()/1e3);var t=e.currentTarget.responseText.substr(o);o=e.currentTarget.responseText.length;for(var r,a=0,s=0;a<t.length;)"RINFO:{"==t.substr(a,7)?(f.append(t.substring(s,a).trim()).scrollTop(f[0].scrollHeight),r=ud_parse_json(t.substr(a),!0),1==d&&console.log(r),function s(e){var t,r,a;"started"==e.stage&&(u=setInterval(function(){var e;(e=Math.round(Date.now()/1e3)-_)<60?p("#updraftplus_ajax_restore_last_activity").html(updraftlion.last_activity.replace("%d",e)):0<(e=120-e)?p("#updraftplus_ajax_restore_last_activity").html(updraftlion.no_recent_activity.replace("%d",e)):(p("#updraftplus_ajax_restore_last_activity").html(""),updraft_send_command("get_restore_resume_notice",{job_id:c},function(e){e.hasOwnProperty("status")&&"success"==e.status&&e.hasOwnProperty("html")?(u&&clearInterval(u),"plugins"!=i&&"db"!=i&&h<5?(h++,y(c,"updraft_ajaxrestore_continue")):p(".updraft_restore_main--components").prepend(e.html)):e.hasOwnProperty("error_code")&&e.hasOwnProperty("error_message")&&(u&&clearInterval(u),alert(e.error_code+": "+e.error_message),console.log(e.error_code+": "+e.error_message))},{error_callback:function(e,t,r,a){500==e.status&&m<3?(m++,y(c,"updraft_ajaxrestore_continue")):(s({stage:"finished",type:"state_change"}),r="updraft_send_command: error: "+t+" ("+r+")",alert(r),console.log(r),console.log(e))}}))},5e3)),"finished"==e.stage&&u&&(clearInterval(u),p("#updraftplus_ajax_restore_last_activity").html("")),e&&("state"!=e.type&&"state_change"!=e.type||(console.log(e.stage,e.data),i="files"==e.stage?e.data.entity:e.stage,t=g.find("[data-component="+i+"]"),"files"==e.stage&&t.find(".updraft_component--progress").html(" — "+updraftlion.restore_files_progress.replace("%s1","<strong>"+e.data.fileindex+"</strong>").replace("%s2","<strong>"+e.data.total_files+"</strong>")),"db"==e.stage&&e.data.hasOwnProperty("stage")&&("table"==e.data.stage?t.find(".updraft_component--progress").html(" — "+updraftlion.restore_db_table_progress.replace("%s","<strong>"+e.data.table+"</strong>")):"stored_routine"==e.data.stage?t.find(".updraft_component--progress").html(" — "+updraftlion.restore_db_stored_routine_progress.replace("%s","<strong>"+e.data.routine_name+"</strong>")):"finished"==e.data.stage?t.find(".updraft_component--progress").html(" — "+updraftlion.finished):"begun"==e.data.stage&&t.find(".updraft_component--progress").html(" — "+updraftlion.begun+"...")),l!==i&&(l&&((r=g.find("[data-component="+l+"]")).find(".updraft_component--progress").html(""),r.removeClass("active").addClass("done")),"finished"==i?(t.addClass("done"),g.find("[data-component]").each(function(e,t){$el=p(t),$el.is(".done")||$el.addClass("error")}),e.data.hasOwnProperty("actions")&&"object"==_typeof(e.data.actions)&&(r=e.data.urls,a=[],p.each(r,function(e,t){var r=new XMLHttpRequest;r.open("GET",t,!1),r.send(null),404==r.status&&a.push(t)}),p.isEmptyObject(r=a)||(p(".updraft_restore_result").before(updraftlion.ajax_restore_404_detected),p.each(r,function(e,t){p(".updraft_missing_pages").append("<li>"+t+"</li>")})),p.each(e.data.actions,function(e,t){g.after('<a href="'+t+'" class="button button-primary">'+e+"</a>")}))):t.addClass("active")),l=i))}(r.parsed),a=s=a+r.json_last_pos-r.json_start_pos+6):a++;f.append(t.substr(s).trim()).scrollTop(f[0].scrollHeight),f.find("input[name=connection_type]").length&&f.find("#upgrade").length&&(p(".updraft_restore_main").addClass("show-credentials-form"),p("#message").length&&(p(".restore-credential-errors .restore-credential-errors--list").appendTo(p("#message")),p(".restore-credential-errors .restore-credential-errors--link").appendTo(p("#message"))))}}else 0==e.currentTarget.status?f.append("UpdraftPlus "+updraftlion.ajax_restore_error+" "+updraftlion.ajax_restore_contact_failed):f.append("UpdraftPlus "+updraftlion.ajax_restore_error+" "+e.currentTarget.status+" "+e.currentTarget.statusText),console.log("UpdraftPlus restore error: "+e.currentTarget.status+" "+e.currentTarget.statusText),console.log(e.currentTarget)},r.onload=function(){var e,t=f.find(".updraft_restore_successful, .updraft_restore_error");t.length&&((e=p(".updraft_restore_result")).slideDown(),g.slideUp(),g.siblings("h2").slideUp(),t.is(".updraft_restore_successful")?(e.find(".dashicons").addClass("dashicons-yes"),e.find(".updraft_restore_result--text").text(t.text()),e.addClass("restore-success")):t.is(".updraft_restore_error")&&(e.find(".dashicons").addClass("dashicons-no-alt"),e.find(".updraft_restore_result--text").text(t.text()),e.addClass("restore-error")),setTimeout(function(){f.scrollTop(f[0].scrollHeight)},500))},r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(e)}p("#updraft-restore-hidethis").remove(),y(c,e),p("#updraftplus_ajax_restore_progress").on("click","#updraft_restore_resume",function(e){e.preventDefault(),p("#updraftplus_ajax_restore_progress").slideUp(1e3,function(){p(this).remove()}),y(c,"updraft_ajaxrestore_continue")}),p(document).on("heartbeat-tick",function(e,t){t.hasOwnProperty("wp-auth-check")&&(t["wp-auth-check"]?(r&&t["wp-auth-check"]&&(_=Math.round(Date.now()/1e3),r=!1),!t.hasOwnProperty("updraftplus")||(t=t.updraftplus).hasOwnProperty("updraft_credentialtest_nonce")&&(updraft_credentialtest_nonce=t.updraft_credentialtest_nonce,_=Math.round(Date.now()/1e3))):r=!0)})});