"use strict";!function(){var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),g=tinymce.util.Tools.resolve("tinymce.util.Tools");function v(e){return e&&1===e.nodeType&&"false"===e.contentEditable}function m(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function h(e){var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function o(e,t){var n,r=[];if((n=g.toArray(e.getBody().getElementsByTagName("span"))).length)for(var a=0;a<n.length;a++){var i=m(n[a]);null!==i&&i.length&&i===t.toString()&&r.push(n[a])}return r}function u(e,t,n){var r=t.get(),a=e.dom;(n=!1!==n)?r++:r--,a.removeClass(o(e,t.get()),"mce-match-marker-selected");var i=o(e,r);return i.length?(a.addClass(o(e,r),"mce-match-marker-selected"),e.selection.scrollIntoView(i[0]),r):-1}function p(e,t){var n=t.parentNode;e.remove(t),e.isEmpty(n)&&e.remove(n)}function b(e,t){var n=u(e,t,!0);-1!==n&&t.set(n)}function x(e,t){var n=u(e,t,!1);-1!==n&&t.set(n)}function N(e){var t=m(e);return null!==t&&0<t.length}function f(e,t,n){for(var r,a,i=g.toArray(e.getBody().getElementsByTagName("span")),o=0;o<i.length;o++){var d=m(i[o]);null!==d&&d.length&&(d===t.get().toString()&&(r=r||i[o].firstChild,a=i[o].firstChild),h(i[o]))}if(r&&a){var c=e.dom.createRng();return c.setStart(r,0),c.setEnd(a,a.data.length),!1!==n&&e.selection.setRng(c),c}}function y(e,t){return 0<o(e,t.get()+1).length}function k(e,t){return 0<o(e,t.get()-1).length}function c(i,o){var e,d={};function c(){s.statusbar.find("#next").disabled(!1===E(i,o)),s.statusbar.find("#prev").disabled(!1===t(i,o))}function l(){i.windowManager.alert("Could not find the specified string.",function(){s.find("#find")[0].focus()})}i.undoManager.add(),e=g.trim(i.selection.getContent({format:"text"}));var s=i.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){i.focus(),w(i,o),i.undoManager.add()},onSubmit:function(e){var t,n,r,a;return e.preventDefault(),n=s.find("#case").checked(),a=s.find("#words").checked(),(r=s.find("#find").value()).length?d.text===r&&d.caseState===n&&d.wholeWord===a?E(i,o)?(I(i,o),void c()):void l():((t=B(i,o,r,n,a))||l(),s.statusbar.items().slice(1).disabled(0===t),c(),void(d={text:r,caseState:n,wholeWord:a})):(w(i,o,!1),void s.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){s.submit()}},{text:"Replace",disabled:!0,onclick:function(){S(i,o,s.find("#replace").value())||(s.statusbar.items().slice(1).disabled(!0),o.set(-1),d={})}},{text:"Replace all",disabled:!0,onclick:function(){S(i,o,s.find("#replace").value(),!0,!0),s.statusbar.items().slice(1).disabled(!0),d={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){T(i,o),c()}},{text:"Next",name:"next",disabled:!0,onclick:function(){I(i,o),c()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:e},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}})}function l(e,t){return function(){c(e,t)}}var C=function(e,t,n,r,a){var i,o,h,f,g,m,d,c,p,l=[],s=0;function u(e,t){if(t=t||0,!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");var n=e.index;if(0<t){var r=e[t];if(!r)throw new Error("Invalid capture group");n+=e[0].indexOf(r),e[0]=r}return[n,n+e[0].length,[e[0]]]}if(h=t.ownerDocument,f=a.getBlockElements(),g=a.getWhiteSpaceElements(),m=a.getShortEndedElements(),o=function e(t){var n;if(3===t.nodeType)return t.data;if(g[t.nodeName]&&!f[t.nodeName])return"";if(n="",v(t))return"\n";if((f[t.nodeName]||m[t.nodeName])&&(n+="\n"),t=t.firstChild)for(;n+=e(t),t=t.nextSibling;);return n}(t)){if(e.global)for(;i=e.exec(o);)l.push(u(i,r));else i=o.match(e),l.push(u(i,r));return l.length&&(s=l.length,function(e,t,n){var r,a,i,o,d=[],c=0,l=e,s=t.shift(),u=0;e:for(;;){if((f[l.nodeName]||m[l.nodeName]||v(l))&&c++,3===l.nodeType&&(!a&&l.length+c>=s[1]?(a=l,o=s[1]-c):r&&d.push(l),!r&&l.length+c>s[0]&&(r=l,i=s[0]-c),c+=l.length),r&&a){if(l=n({startNode:r,startNodeIndex:i,endNode:a,endNodeIndex:o,innerNodes:d,match:s[2],matchIndex:u}),c-=a.length-o,a=r=null,d=[],u++,!(s=t.shift()))break}else if(g[l.nodeName]&&!f[l.nodeName]||!l.firstChild){if(l.nextSibling){l=l.nextSibling;continue}}else if(!v(l)){l=l.firstChild;continue}for(;;){if(l.nextSibling){l=l.nextSibling;break}if(l.parentNode===e)break e;l=l.parentNode}}}(t,l,(p="function"!=typeof(d=n)?(c=d.nodeType?d:h.createElement(d),function(e,t){var n=c.cloneNode(!1);return n.setAttribute("data-mce-index",t),e&&n.appendChild(h.createTextNode(e)),n}):d,function(e){var t,n,r=e.startNode,a=e.endNode,i=e.matchIndex;if(r===a){var o=r,d=o.parentNode;0<e.startNodeIndex&&(t=h.createTextNode(o.data.substring(0,e.startNodeIndex)),d.insertBefore(t,o));var c=p(e.match[0],i);return d.insertBefore(c,o),e.endNodeIndex<o.length&&(n=h.createTextNode(o.data.substring(e.endNodeIndex)),d.insertBefore(n,o)),o.parentNode.removeChild(o),c}t=h.createTextNode(r.data.substring(0,e.startNodeIndex)),n=h.createTextNode(a.data.substring(e.endNodeIndex));for(var l=p(r.data.substring(e.startNodeIndex),i),s=0,u=e.innerNodes.length;s<u;++s){var f=e.innerNodes[s],g=p(f.data,i);f.parentNode.replaceChild(g,f)}var m=p(a.data.substring(0,e.endNodeIndex),i);return(d=r.parentNode).insertBefore(t,r),d.insertBefore(l,r),d.removeChild(r),(d=a.parentNode).insertBefore(m,a),d.insertBefore(n,a),d.removeChild(a),m}))),s}},w=f,B=function(e,t,n,r,a){n=(n=n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\s/g,"[^\\S\\r\\n]"),n=a?"\\b"+n+"\\b":n;var i,o,d,c,l,s=(i=e,o=t,d=new RegExp(n,r?"g":"gi"),(l=i.dom.create("span",{"data-mce-bogus":1})).className="mce-match-marker",c=i.getBody(),f(i,o,!1),C(d,c,l,!1,i.schema));return s&&(t.set(-1),t.set(u(e,t,!0))),s},I=b,T=x,S=function(e,t,n,r,a){var i,o,d,c,l,s=t.get();for(r=!1!==r,d=e.getBody(),o=g.grep(g.toArray(d.getElementsByTagName("span")),N),i=0;i<o.length;i++){var u=m(o[i]),f=c=parseInt(u,10);if(a||f===t.get()){for(n.length?(o[i].firstChild.nodeValue=n,h(o[i])):p(e.dom,o[i]);o[++i];){if((f=parseInt(m(o[i]),10))!==c){i--;break}p(e.dom,o[i])}r&&s--}else c>t.get()&&o[i].setAttribute("data-mce-index",c-1)}return t.set(s),r?(l=y(e,t),b(e,t)):(l=k(e,t),x(e,t)),!a&&l},E=y,t=k;e.add("searchreplace",function(e){var r,a,t,n,i,o,d=function e(t){function n(){return r}var r=t;return{get:n,set:function(e){r=e},clone:function(){return e(n())}}}(-1);return o=d,(i=e).addCommand("SearchReplace",function(){c(i,o)}),n=d,(t=e).addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:l(t,n),separator:"before",context:"edit"}),t.addButton("searchreplace",{tooltip:"Find and replace",onclick:l(t,n)}),t.shortcuts.add("Meta+F","",l(t,n)),r=e,a=d,{done:function(e){return w(r,a,e)},find:function(e,t,n){return B(r,a,e,t,n)},next:function(){return I(r,a)},prev:function(){return T(r,a)},replace:function(e,t,n){return S(r,a,e,t,n)}}})}();