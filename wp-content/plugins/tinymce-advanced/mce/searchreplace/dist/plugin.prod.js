"use strict";!function(){var e,p,u,f,g,h,m,n,r,a,i;e=tinymce.util.Tools.resolve("tinymce.PluginManager"),p=tinymce.util.Tools.resolve("tinymce.util.Tools"),u={findAndReplaceDOMText:function(e,t,n,r,a){var i,o,h,f,p,g,d,c,m,l=[],s=0;function u(e,t){if(t=t||0,!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");var n=e.index;if(0<t){var r=e[t];if(!r)throw new Error("Invalid capture group");n+=e[0].indexOf(r),e[0]=r}return[n,n+e[0].length,[e[0]]]}if(h=t.ownerDocument,f=a.getBlockElements(),p=a.getWhiteSpaceElements(),g=a.getShortEndedElements(),o=function e(t){var n;if(3===t.nodeType)return t.data;if(p[t.nodeName]&&!f[t.nodeName])return"";if(n="",v(t))return"\n";if((f[t.nodeName]||g[t.nodeName])&&(n+="\n"),t=t.firstChild)for(;n+=e(t),t=t.nextSibling;);return n}(t)){if(e.global)for(;i=e.exec(o);)l.push(u(i,r));else i=o.match(e),l.push(u(i,r));return l.length&&(s=l.length,function(e,t,n){var r,a,i,o,d=[],c=0,l=e,s=t.shift(),u=0;e:for(;;){if((f[l.nodeName]||g[l.nodeName]||v(l))&&c++,3===l.nodeType&&(!a&&l.length+c>=s[1]?(a=l,o=s[1]-c):r&&d.push(l),!r&&l.length+c>s[0]&&(r=l,i=s[0]-c),c+=l.length),r&&a){if(l=n({startNode:r,startNodeIndex:i,endNode:a,endNodeIndex:o,innerNodes:d,match:s[2],matchIndex:u}),c-=a.length-o,a=r=null,d=[],u++,!(s=t.shift()))break}else if(p[l.nodeName]&&!f[l.nodeName]||!l.firstChild){if(l.nextSibling){l=l.nextSibling;continue}}else if(!v(l)){l=l.firstChild;continue}for(;;){if(l.nextSibling){l=l.nextSibling;break}if(l.parentNode===e)break e;l=l.parentNode}}}(t,l,(m="function"!=typeof(d=n)?(c=d.nodeType?d:h.createElement(d),function(e,t){var n=c.cloneNode(!1);return n.setAttribute("data-mce-index",t),e&&n.appendChild(h.createTextNode(e)),n}):d,function(e){var t,n,r=e.startNode,a=e.endNode,i=e.matchIndex;if(r===a){var o=r,d=o.parentNode;0<e.startNodeIndex&&(t=h.createTextNode(o.data.substring(0,e.startNodeIndex)),d.insertBefore(t,o));var c=m(e.match[0],i);return d.insertBefore(c,o),e.endNodeIndex<o.length&&(n=h.createTextNode(o.data.substring(e.endNodeIndex)),d.insertBefore(n,o)),o.parentNode.removeChild(o),c}t=h.createTextNode(r.data.substring(0,e.startNodeIndex)),n=h.createTextNode(a.data.substring(e.endNodeIndex));for(var l=m(r.data.substring(e.startNodeIndex),i),s=0,u=e.innerNodes.length;s<u;++s){var f=e.innerNodes[s],p=m(f.data,i);f.parentNode.replaceChild(p,f)}var g=m(a.data.substring(0,e.endNodeIndex),i);return(d=r.parentNode).insertBefore(t,r),d.insertBefore(l,r),d.removeChild(r),(d=a.parentNode).insertBefore(g,a),d.insertBefore(n,a),d.removeChild(a),g}))),s}}},m={done:f=function(e,t,n){for(var r,a,i=p.toArray(e.getBody().getElementsByTagName("span")),o=0;o<i.length;o++){var d=x(i[o]);null!==d&&d.length&&(d===t.get().toString()&&(r=r||i[o].firstChild,a=i[o].firstChild),b(i[o]))}if(r&&a){var c=e.dom.createRng();return c.setStart(r,0),c.setEnd(a,a.data.length),!1!==n&&e.selection.setRng(c),c}},find:function(e,t,n,r,a){n=(n=n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\s/g,"[^\\S\\r\\n]"),n=a?"\\b"+n+"\\b":n;var i,o,d,c,l,s=(i=e,o=t,d=new RegExp(n,r?"g":"gi"),(l=i.dom.create("span",{"data-mce-bogus":1})).className="mce-match-marker",c=i.getBody(),f(i,o,!1),u.findAndReplaceDOMText(d,c,l,!1,i.schema));return s&&(t.set(-1),t.set(N(e,t,!0))),s},next:k,prev:C,replace:function(e,t,n,r,a){var i,o,d,c,l,s=t.get();for(r=!1!==r,d=e.getBody(),o=p.grep(p.toArray(d.getElementsByTagName("span")),T),i=0;i<o.length;i++){var u=x(o[i]),f=c=parseInt(u,10);if(a||f===t.get()){for(n.length?(o[i].firstChild.nodeValue=n,b(o[i])):y(e.dom,o[i]);o[++i];){if((f=parseInt(x(o[i]),10))!==c){i--;break}y(e.dom,o[i])}r&&s--}else c>t.get()&&o[i].setAttribute("data-mce-index",c-1)}return t.set(s),r?(l=g(e,t),k(e,t)):(l=h(e,t),C(e,t)),!a&&l},hasNext:g=function(e,t){return 0<o(e,t.get()+1).length},hasPrev:h=function(e,t){return 0<o(e,t.get()-1).length}},n=function(r,a){return{done:function(e){return m.done(r,a,e)},find:function(e,t,n){return m.find(r,a,e,t,n)},next:function(){return m.next(r,a)},prev:function(){return m.prev(r,a)},replace:function(e,t,n){return m.replace(r,a,e,t,n)}}},r=function(i,o){var e,d={};function c(){s.statusbar.find("#next").disabled(!1===m.hasNext(i,o)),s.statusbar.find("#prev").disabled(!1===m.hasPrev(i,o))}function l(){i.windowManager.alert("Could not find the specified string.",function(){s.find("#find")[0].focus()})}i.undoManager.add(),e=p.trim(i.selection.getContent({format:"text"}));var s=i.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){i.focus(),m.done(i,o),i.undoManager.add()},onSubmit:function(e){var t,n,r,a;return e.preventDefault(),n=s.find("#case").checked(),a=s.find("#words").checked(),(r=s.find("#find").value()).length?d.text===r&&d.caseState===n&&d.wholeWord===a?m.hasNext(i,o)?(m.next(i,o),void c()):void l():((t=m.find(i,o,r,n,a))||l(),s.statusbar.items().slice(1).disabled(0===t),c(),void(d={text:r,caseState:n,wholeWord:a})):(m.done(i,o,!1),void s.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){s.submit()}},{text:"Replace",disabled:!0,onclick:function(){m.replace(i,o,s.find("#replace").value())||(s.statusbar.items().slice(1).disabled(!0),o.set(-1),d={})}},{text:"Replace all",disabled:!0,onclick:function(){m.replace(i,o,s.find("#replace").value(),!0,!0),s.statusbar.items().slice(1).disabled(!0),d={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){m.prev(i,o),c()}},{text:"Next",name:"next",disabled:!0,onclick:function(){m.next(i,o),c()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:e},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}})},a=function(e,t){e.addCommand("SearchReplace",function(){r(e,t)})},i=function(e,t){e.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:d(e,t),separator:"before",context:"edit"}),e.addButton("searchreplace",{tooltip:"Find and replace",onclick:d(e,t)}),e.shortcuts.add("Meta+F","",d(e,t))},e.add("searchreplace",function(e){var t=function e(t){function n(){return r}var r=t;return{get:n,set:function(e){r=e},clone:function(){return e(n())}}}(-1);return a(e,t),i(e,t),n(e,t)});function v(e){return e&&1===e.nodeType&&"false"===e.contentEditable}function x(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function b(e){var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function o(e,t){var n=[],r=p.toArray(e.getBody().getElementsByTagName("span"));if(r.length)for(var a=0;a<r.length;a++){var i=x(r[a]);null!==i&&i.length&&i===t.toString()&&n.push(r[a])}return n}function N(e,t,n){var r=t.get(),a=e.dom;(n=!1!==n)?r++:r--,a.removeClass(o(e,t.get()),"mce-match-marker-selected");var i=o(e,r);return i.length?(a.addClass(o(e,r),"mce-match-marker-selected"),e.selection.scrollIntoView(i[0]),r):-1}function y(e,t){var n=t.parentNode;e.remove(t),e.isEmpty(n)&&e.remove(n)}function k(e,t){var n=N(e,t,!0);-1!==n&&t.set(n)}function C(e,t){var n=N(e,t,!1);-1!==n&&t.set(n)}function T(e){var t=x(e);return null!==t&&0<t.length}function d(e,t){return function(){r(e,t)}}}();