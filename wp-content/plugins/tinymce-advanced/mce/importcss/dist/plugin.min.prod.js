"use strict";!function(){function d(e){return e.getParam("importcss_selector_converter")}function n(t){return"string"==typeof t?function(e){return-1!==e.indexOf(t)}:t instanceof RegExp?function(e){return t.test(e)}:t}function r(u,e,m){var f=[],n={};T.each(u.contentCSS,function(e){n[e]=!0}),m=m||function(e,t){return t||n[e]};try{T.each(e.styleSheets,function(e){!function t(e,n){var r,i,s,c,o=e.href,l=o,a=p.cacheSuffix;if("string"==typeof l&&(l=l.replace("?"+a,"").replace("&"+a,"")),(o=l)&&m(o,n)&&(!(c=!1!==(s=(i=u).settings).skin&&(s.skin||"lightgray"))||o!==(s.skin_url?i.documentBaseURI.toAbsolute(s.skin_url):g.baseURL+"/skins/"+c)+"/content"+(i.inline?".inline":"")+".min.css")){T.each(e.imports,function(e){t(e,!0)});try{r=e.cssRules||e.rules}catch(e){}T.each(r,function(e){e.styleSheet?t(e.styleSheet,!0):e.selectorText&&T.each(e.selectorText.split(","),function(e){f.push(T.trim(e))})})}}(e)})}catch(e){}return f}function y(e,t){var n,r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(r){var i=r[1],s=r[2].substr(1).split(".").join(" "),c=T.makeMap("a,img");return r[1]?(n={title:t},e.schema.getTextBlockElements()[i]?n.block=i:e.schema.getBlockElements()[i]||c[i.toLowerCase()]?n.selector=i:n.inline=i):r[2]&&(n={inline:"span",title:t.substr(1),classes:s}),!1!==e.getParam("importcss_merge_classes")?n.classes=s:n.attributes={class:s},n}}function _(e,t){return null===t||!1!==e.getParam("importcss_exclusive")}function i(h){h.on("renderFormatsMenu",function(e){function i(e,t){if(m=e,g=p,!(_(h,f=t)?m in g:m in f.selectors)){l=e,u=p,_(h,a=t)?u[l]=!0:a.selectors[l]=!0;var n=(s=(i=h).plugins.importcss,c=e,((o=t)&&o.selector_converter?o.selector_converter:d(i)?d(i):function(){return y(i,c)}).call(s,c,o));if(n){var r=n.name||x.DOM.uniqueId();return h.formatter.register(r,n),T.extend({},v.settings.itemDefaults,{text:n.title,format:r})}}var i,s,c,o,l,a,u,m,f,g;return null}var t,p={},s=n(h.getParam("importcss_selector_filter")),v=e.control,c=(t=h.getParam("importcss_groups"),T.map(t,function(e){return T.extend({},e,{original:e,selectors:{},filter:n(e.filter),item:{text:e.title,menu:[]}})}));h.getParam("importcss_append")||v.items().remove(),T.each(r(h,e.doc||h.getDoc(),n(h.getParam("importcss_file_filter"))),function(n){var e,t,r;-1!==n.indexOf(".mce-")||s&&!s(n)||(r=n,0<(e=T.grep(c,function(e){return!e.filter||e.filter(r)})).length?T.each(e,function(e){var t=i(n,e);t&&e.item.menu.push(t)}):(t=i(n,null))&&v.add(t))}),T.each(c,function(e){0<e.item.menu.length&&v.add(e.item)}),e.control.renderNew()})}var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),x=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),g=tinymce.util.Tools.resolve("tinymce.EditorManager"),p=tinymce.util.Tools.resolve("tinymce.Env"),T=tinymce.util.Tools.resolve("tinymce.util.Tools"),s=y;e.add("importcss",function(e){return i(e),t=e,{convertSelectorToFormat:function(e){return s(t,e)}};var t})}();