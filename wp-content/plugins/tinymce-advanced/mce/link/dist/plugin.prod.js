"use strict";!function(){var a,t,n,p,l,i,k,y,b,_,w,T,C,M,O,R,N,u,c,r,A,s,o,f,L,P,d,m,E,S,I,K,g,v,U,e,h,x,D,B,F,q,V,z,H,J,$;a=window,t=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.util.VK"),p=function(t){return"boolean"==typeof t.link_assume_external_targets&&t.link_assume_external_targets},l=function(t){return"boolean"==typeof t.link_context_toolbar&&t.link_context_toolbar},i=function(t){return t.link_list},k=function(t){return"string"==typeof t.default_link_target},y=function(t){return t.default_link_target},b=j,_=function(t,e){t.settings.target_list=e},w=function(t){return!1!==j(t)},T=G,C=function(t){return void 0!==G(t)},M=X,O=function(t){return void 0!==X(t)},R=function(t){return!1!==t.link_title},N=function(t){return"boolean"==typeof t.allow_unsafe_link_target&&t.allow_unsafe_link_target},u=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),c=tinymce.util.Tools.resolve("tinymce.Env"),r=function(t){var e,n,o,i,r,l;!c.ie||10<c.ie?((e=a.document.createElement("a")).target="_blank",e.href=t,e.rel="noreferrer noopener",(n=a.document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,a.window,0,0,0,0,0,!1,!1,!1,!1,0,null),r=e,l=n,a.document.body.appendChild(r),r.dispatchEvent(l),a.document.body.removeChild(r)):(o=a.window.open("","_blank"))&&(o.opener=null,(i=o.document).open(),i.write('<meta http-equiv="refresh" content="0; url='+u.DOM.encode(t)+'">'),i.close())},A=tinymce.util.Tools.resolve("tinymce.util.Tools"),s=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},o=function(t,e){var n,o=t.dom.select("img",e)[0];o&&(n=t.dom.getParents(o,"a[href]",e)[0])&&(n.parentNode.insertBefore(o,n),t.dom.remove(n))},f=function(t,e,n){var o,i=t.dom.select("img",e)[0];i&&(o=t.dom.create("a",n),i.parentNode.insertBefore(o,i),o.appendChild(i))},L=function(i,r){return function(o){i.undoManager.transact(function(){var t=i.selection.getNode(),e=W(i,t),n={href:o.href,target:o.target?o.target:null,rel:o.rel?o.rel:null,class:o.class?o.class:null,title:o.title?o.title:null};C(i.settings)||!1!==N(i.settings)||(n.rel=Q(n.rel,"_blank"===n.target)),o.href===r.href&&(r.attach(),r={}),e?(i.focus(),o.hasOwnProperty("text")&&("innerText"in e?e.innerText=o.text:e.textContent=o.text),i.dom.setAttribs(e,n),i.selection.select(e),i.undoManager.add()):s(t)?f(i,t,n):o.hasOwnProperty("text")?i.insertContent(i.dom.createHTML("a",n,i.dom.encode(o.text))):i.execCommand("mceInsertLink",!1,n)})}},P=function(e){return function(){e.undoManager.transact(function(){var t=e.selection.getNode();s(t)?o(e,t):e.execCommand("unlink")})}},d=Y,m=function(t){return 0<A.grep(t,Y).length},E=function(t){return!(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))},S=W,I=function(t,e){var n=e?e.innerText||e.textContent:t.getContent({format:"text"});return n.replace(/\uFEFF/g,"")},K=Q,g=tinymce.util.Tools.resolve("tinymce.util.Delay"),v=tinymce.util.Tools.resolve("tinymce.util.XHR"),U={},e=function(t){var e,n,o;n=et,"string"==typeof(o=i((e=t).settings))?v.send({url:o,success:function(t){n(e,JSON.parse(t))}}):"function"==typeof o?o(function(t){n(e,t)}):n(e,o)},h=function(t){return function(){e(t)}},x=function(t){return function(){it(t,ot(t))}},D=function(r){return function(t){var e,n,o,i;return!!(l(r.settings)&&(!(i=r.plugins.contextmenu)||!i.isContextMenuVisible())&&d(t)&&3===(o=(n=(e=r.selection).getRng()).startContainer).nodeType&&e.isCollapsed()&&0<n.startOffset&&n.startOffset<o.data.length)}},B=function(o){o.on("click",function(t){var e=nt(o,t.target);e&&n.metaKeyPressed(t)&&(t.preventDefault(),it(o,e))}),o.on("keydown",function(t){var e,n=ot(o);n&&13===t.keyCode&&(!0===(e=t).altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey)&&(t.preventDefault(),it(o,n))})},F=function(n){return function(){var e=this;n.on("nodechange",function(t){e.active(!n.readonly&&!!S(n,t.element))})}},q=function(n){return function(){function t(t){m(t.parents)?e.show():e.hide()}var e=this;m(n.dom.getParents(n.selection.getStart()))||e.hide(),n.on("nodechange",t),e.on("remove",function(){n.off("nodechange",t)})}},V=function(t){t.addCommand("mceLink",h(t))},z=function(t){t.addShortcut("Meta+K","",h(t))},H=function(t){t.addButton("link",{active:!1,icon:"link",tooltip:"Insert/edit link",onclick:h(t),onpostrender:F(t)}),t.addButton("unlink",{active:!1,icon:"unlink",tooltip:"Remove link",onclick:P(t),onpostrender:F(t)}),t.addContextToolbar&&t.addButton("openlink",{icon:"newtab",tooltip:"Open link",onclick:x(t)})},J=function(t){t.addMenuItem("openlink",{text:"Open link",icon:"newtab",onclick:x(t),onPostRender:q(t),prependToContext:!0}),t.addMenuItem("link",{icon:"link",text:"Link",shortcut:"Meta+K",onclick:h(t),stateSelector:"a[href]",context:"insert",prependToContext:!0}),t.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onclick:P(t),stateSelector:"a[href]"})},$=function(t){t.addContextToolbar&&t.addContextToolbar(D(t),"openlink | link unlink")},t.add("link",function(t){H(t),J(t),$(t),B(t),V(t),z(t)});function j(t){return t.target_list}function G(t){return t.rel_list}function X(t){return t.link_class_list}function Q(t,e){var n,o,i=["noopener"],r=t?t.split(/\s+/):[],l=function(t){return t.filter(function(t){return-1===A.inArray(i,t)})};return(r=e?(n=l(n=r)).length?n.concat(i):i:l(r)).length?(o=r,A.trim(o.sort().join(" "))):null}function W(t,e){return e=e||t.selection.getNode(),s(e)?t.dom.select("a[href]",e)[0]:t.dom.getParent(e,"a[href]")}function Y(t){return t&&"A"===t.nodeName&&t.href}function Z(t,i,e){return function n(t,o){return o=o||[],A.each(t,function(t){var e={text:t.text||t.title};t.menu?e.menu=n(t.menu):(e.value=t.value,i&&i(e)),o.push(e)}),o}(t,e||[])}function tt(e,t,n){var o=e.selection.getRng();g.setEditorTimeout(e,function(){e.windowManager.confirm(t,function(t){e.selection.setRng(o),n(t)})})}function et(l,t){function e(t){var e=o.find("#text");(!e.value()||t.lastControl&&e.value()===t.lastControl.text())&&e.value(t.control.text()),o.find("#href").value(t.control.value())}function n(){a||!h||m.text||this.parent().parent().find("#text")[0].value(this.value())}var a,o,i,r,u,c,s,f,d,m={},g=l.selection,v=l.dom,h=E(g.getContent()),x=S(l);m.text=a=I(l.selection,x),m.href=x?v.getAttrib(x,"href"):"",x?m.target=v.getAttrib(x,"target"):k(l.settings)&&(m.target=y(l.settings)),(d=v.getAttrib(x,"rel"))&&(m.rel=d),(d=v.getAttrib(x,"class"))&&(m.class=d),(d=v.getAttrib(x,"title"))&&(m.title=d),h&&(i={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){m.text=this.value()}}),t&&(r={type:"listbox",label:"Link list",values:Z(t,function(t){t.value=l.convertURL(t.value||t.url,"href")},[{text:"None",value:""}]),onselect:e,value:l.convertURL(m.href,"href"),onPostRender:function(){r=this}}),w(l.settings)&&(void 0===b(l.settings)&&_(l,[{text:"None",value:""},{text:"New window",value:"_blank"}]),c={name:"target",type:"listbox",label:"Target",values:Z(b(l.settings))}),C(l.settings)&&(u={name:"rel",type:"listbox",label:"Rel",values:Z(T(l.settings),function(t){!1===N(l.settings)&&(t.value=K(t.value,"_blank"===m.target))})}),O(l.settings)&&(s={name:"class",type:"listbox",label:"Class",values:Z(M(l.settings),function(t){t.value&&(t.textStyle=function(){return l.formatter.getCssText({inline:"a",classes:[t.value]})})})}),R(l.settings)&&(f={name:"title",type:"textbox",label:"Title",value:m.title}),o=l.windowManager.open({title:"Insert link",data:m,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:function(t){var e=t.meta||{};r&&r.value(l.convertURL(this.value(),"href")),A.each(t.meta,function(t,e){var n=o.find("#"+e);"text"===e?0===a.length&&(n.value(t),m.text=t):n.value(t)}),e.attach&&(U={href:this.value(),attach:e.attach}),e.text||n.call(this)},onkeyup:n,onpaste:n,onbeforecall:function(t){t.meta=o.toJSON()}},i,f,function(n){var o=[];if(A.each(l.dom.select("a:not([href])"),function(t){var e=t.name||t.id;e&&o.push({text:e,value:"#"+e,selected:-1!==n.indexOf("#"+e)})}),o.length)return o.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:o,onselect:e}}(m.href),r,u,c,s],onSubmit:function(t){var e=p(l.settings),n=L(l,U),o=P(l),i=A.extend({},m,t.data),r=i.href;r?(h&&i.text!==a||delete i.text,0<r.indexOf("@")&&-1===r.indexOf("//")&&-1===r.indexOf("mailto:")?tt(l,"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(t){t&&(i.href="mailto:"+r),n(i)}):!0===e&&!/^\w+:/i.test(r)||!1===e&&/^\s*www[\.|\d\.]/i.test(r)?tt(l,"The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(t){t&&(i.href="http://"+r),n(i)}):n(i)):o()}})}function nt(t,e){return t.dom.getParent(e,"a[href]")}function ot(t){return nt(t,t.selection.getStart())}function it(t,e){var n,o,i;e&&(n=(i=e).getAttribute("data-mce-href")||i.getAttribute("href"),/^#/.test(n)?(o=t.$(n)).length&&t.selection.scrollIntoView(o[0],!0):r(e.href))}}();