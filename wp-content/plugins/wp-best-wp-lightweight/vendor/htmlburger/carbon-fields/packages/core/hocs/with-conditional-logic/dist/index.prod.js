"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=withConditionalLogic;var _compose=require("@wordpress/compose"),_data=require("@wordpress/data"),_refractCallbag=require("refract-callbag"),_i18n=require("@wordpress/i18n"),_lodash=require("lodash"),_compare=_interopRequireDefault(require("./compare"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function withConditionalLogic(r,l){function i(e,i){if(!(0,_lodash.isEmpty)(i.field.conditional_logic))return r(i,e)}function o(d){return function(e){if((0,_lodash.has)(e,d.name)||(0,_lodash.find)(e,["id",d.id])){var i=d.field.conditional_logic,r=i.relation,o=i.rules,n=l(d,e),t=o.reduce(function(e,i){if(!(0,_lodash.has)(n,i.field))return console.error((0,_i18n.sprintf)((0,_i18n.__)('An unknown field is used in condition - "%s"',"carbon-fields-ui"),i.field)),e.concat(!1);var r=(0,_compare.default)(n[i.field],i.compare,i.value);return e.concat(r)},[]),a=!1;switch(r){case"AND":a=(0,_lodash.every)(t);break;case"OR":a=(0,_lodash.some)(t)}a?d.showField(d.id):d.hideField(d.id)}}}return(0,_compose.createHigherOrderComponent)(function(e){return(0,_compose.compose)((0,_data.withDispatch)(function(e){var i=e("carbon-fields/core");return{showField:i.showField,hideField:i.hideField}}),(0,_data.withSelect)(function(e,i){return{visible:e("carbon-fields/core").isFieldVisible(i.id)}}),(0,_refractCallbag.withEffects)(i,{handler:o}))(e)},"withConditionalLogic")}