"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _callbagOf=_interopRequireDefault(require("callbag-of")),_callbagTakeUntil=_interopRequireDefault(require("callbag-take-until")),_callbagDistinctUntilChanged=_interopRequireDefault(require("callbag-distinct-until-changed")),_callbagBasics=require("callbag-basics"),_data=require("@wordpress/data"),_lodash=require("lodash"),_core=require("@carbon-fields/core");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var a=[],r=!0,i=!1,n=void 0;try{for(var l,o=e[Symbol.iterator]();!(r=(l=o.next()).done)&&(a.push(l.value),!t||a.length!==t);r=!0);}catch(e){i=!0,n=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw n}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function getFieldsFromFieldsHolder(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return void 0===e?[]:(0,_lodash.pick)(t,(0,_lodash.difference)((0,_lodash.map)(e.fields,"id"),a))}function mapParentPrefix(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return(0,_lodash.map)(e,function(e){return[e.id,"".concat((0,_lodash.repeat)("parent.",t)).concat(e.base_name)]})}function input(e,t){var a=(0,_data.select)("carbon-fields/metaboxes").getFieldsByContainerId;return(0,_callbagBasics.pipe)((0,_callbagBasics.merge)((0,_callbagOf.default)(a(e.containerId)),(0,_core.fromSelector)(a,e.containerId)),(0,_callbagTakeUntil.default)(t.unmount),(0,_callbagDistinctUntilChanged.default)(_lodash.isEqual))}function output(t,r){r=(0,_lodash.keyBy)(r,"id");var e=(0,_data.select)("carbon-fields/metaboxes").getContainerById(t.containerId),a=[];if((0,_lodash.some)(e.fields,["id",t.id]))a=mapParentPrefix(a=getFieldsFromFieldsHolder(e,r,[t.id]));else{var i=t.name.replace(new RegExp("^".concat(window.cf.config.compactInputKey,"\\[(.+?)\\]")),"$1"),n=(0,_lodash.find)(r,function(e){return e.container_id===t.containerId&&(0,_lodash.startsWith)(i,e.name)}),l=i.split(/\[|\]/g);l.shift(),(l=l.filter(function(e){return""!==e})).pop();var o=l.reduce(function(e,t){return isNaN(t)?e+1:e},0);a=mapParentPrefix(a=getFieldsFromFieldsHolder(e,r,[n.id]),o+1);for(var c="".concat(n.id,".value");0<l.length;){var d,s,u=l.shift(),f=!isNaN(u),_=!f;f&&(c="".concat(c,"[").concat(u,"]"),d=getFieldsFromFieldsHolder((0,_lodash.get)(r,c),r,[t.id]),a=a.concat(mapParentPrefix(d,o)),c="".concat(c,".fields")),_&&(s=(0,_lodash.find)((0,_lodash.get)(r,c),["name",u]),c="".concat(s.id,".value"),o--)}}return a=a.map(function(e){var t=_slicedToArray(e,2),a=t[0];return[t[1],(0,_lodash.get)(r,"".concat(a,".value"))]}),(0,_lodash.fromPairs)(a)}var _default=(0,_core.withConditionalLogic)(input,output);exports.default=_default;