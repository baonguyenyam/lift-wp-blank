"use strict";var _callbagOf=_interopRequireDefault(require("callbag-of")),_callbagStartWith=_interopRequireDefault(require("callbag-start-with")),_callbagDistinctUntilChanged=_interopRequireDefault(require("callbag-distinct-until-changed")),_hooks=require("@wordpress/hooks"),_data=require("@wordpress/data"),_lodash=require("lodash"),_callbagBasics=require("callbag-basics"),_core=require("@carbon-fields/core"),_getParentIdFromOption=_interopRequireDefault(require("../utils/get-parent-id-from-option")),_getLevelFromOption=_interopRequireDefault(require("../utils/get-level-from-option")),_getAncestorsFromOption=_interopRequireDefault(require("../utils/get-ancestors-from-option"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],a=!0,o=!1,i=void 0;try{for(var n,l=e[Symbol.iterator]();!(a=(n=l.next()).done)&&(r.push(n.value),!t||r.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw i}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var INITIAL_STATE={post_ancestors:[],post_parent_id:0,post_level:1};function getParentIdAncestorsAndLevelFromSelect(e){var t=e.options[e.selectedIndex];return{post_ancestors:(0,_getAncestorsFromOption.default)(t),post_parent_id:(0,_getParentIdFromOption.default)(t),post_level:(0,_getLevelFromOption.default)(t)+1}}function getAncestorsFromPostsList(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=(0,_lodash.find)(t,["id",e]);return a?(r.unshift(a.id),a.parent?getAncestorsFromPostsList(a.parent,t,r):r):r}(0,_hooks.addFilter)("carbon-fields.conditional-display-post-parent.classic","carbon-fields/metaboxes",function(){var e=document.querySelector("select#parent_id");return e?(0,_callbagBasics.pipe)((0,_callbagBasics.fromEvent)(e,"change"),(0,_callbagBasics.map)(function(e){return getParentIdAncestorsAndLevelFromSelect(e.target)}),(0,_callbagStartWith.default)(getParentIdAncestorsAndLevelFromSelect(e))):(0,_callbagOf.default)(INITIAL_STATE)}),(0,_hooks.addFilter)("carbon-fields.conditional-display-post-parent.gutenberg","carbon-fields/metaboxes",function(){var e=(0,_data.select)("core"),l=e.getPostType,s=e.getEntityRecords;return(0,_callbagBasics.pipe)((0,_callbagBasics.combine)((0,_core.fromSelector)((0,_data.select)("core/editor").getCurrentPostId),(0,_core.fromSelector)((0,_data.select)("core/editor").getEditedPostAttribute,"type"),(0,_core.fromSelector)((0,_data.select)("core/editor").getEditedPostAttribute,"parent")),(0,_callbagDistinctUntilChanged.default)(_lodash.isEqual),(0,_callbagBasics.map)(function(e){var t=_slicedToArray(e,3),r=t[0],a=t[1],o=t[2],o=parseInt(o,10);if(isNaN(o))return INITIAL_STATE;var i=l(a);if(!(0,_lodash.get)(i,["hierarchical"],!1))return INITIAL_STATE;var n=getAncestorsFromPostsList(o,s("postType",a,{per_page:-1,exclude:r,parent_exclude:r,orderby:"menu_order",order:"asc"})||[]);return{post_ancestors:n,post_parent_id:o,post_level:n.length+1}}))});